<?xml version="1.0"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:camel="http://camel.apache.org/schema/spring"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
          http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

    <!-- for queue -->
    <bean id="myFirstConsumer" class="com.epam.democamel.Consumer">
        <property name="name" value="first consumer"/>
    </bean>
    <bean id="mySecondConsumer" class="com.epam.democamel.Consumer">
        <property name="name" value="second consumer"/>
    </bean>
    <bean id="justConsumer" class="com.epam.democamel.Consumer"/>
    <bean id="deserialization" class="com.epam.democamel.processor.ActiveMQUnwrapper"/>
    <bean id="myDroppedBean" class="com.epam.democamel.DroppedHandler"/>

    <!-- for topic -->
    <bean id="a" class="com.epam.democamel.Consumer"/>
    <bean id="b" class="com.epam.democamel.Consumer"/>
    <bean id="c" class="com.epam.democamel.Consumer"/>

    <camel:camelContext id="camelCtx">
        <camel:route>
            <camel:from uri="activemq://queue:Queue"/>
            <!--<camel:to uri="log:com.mycompany.MyLog?level=INFO"/>-->
            <!--<camel:log message="Me got ${body}" loggingLevel="INFO"-->
            <!--logName="com.mycompany.MyCoolRouteLog"/>-->
            <camel:choice>

                <!-- processing test5 -->
                <camel:when>
                    <!-- USE -->
                    <!-- Requires camel-juel or juel dependency -->
                    <camel:el>${in.headers.Task == 'test5'}</camel:el>
                    <!-- OR -->
                    <!--<camel:simple>${header.task} == 'test5'</camel:simple>-->
                    <camel:choice>
                        <camel:when>
                            <camel:simple>${header.Consumer} == '1'</camel:simple>
                            <camel:to uri="bean:myFirstConsumer?method=consumeFromQueue"/>
                        </camel:when>
                        <camel:when>
                            <camel:simple>${header.Consumer} == '2'</camel:simple>
                            <camel:to uri="bean:mySecondConsumer?method=consumeFromQueue"/>
                        </camel:when>
                        <camel:otherwise>
                            <camel:to uri="bean:myDroppedBean"/>
                        </camel:otherwise>
                    </camel:choice>
                </camel:when>

                <!-- processing test6 -->
                <camel:when>
                    <camel:simple>${header.Task} == 'test6'</camel:simple>
                    <camel:process ref="deserialization"/>
                    <camel:to uri="bean:justConsumer?method=consumeFromQueue"/>
                </camel:when>
                <!-- processing test1, test3, test4 -->
                <camel:otherwise>
                    <camel:to uri="bean:justConsumer?method=consumeFromQueue"/>
                </camel:otherwise>
            </camel:choice>

        </camel:route>

        <camel:route>
            <camel:from uri="activemq://queue:TransformQueue?concurrentConsumers=2"/>
            <camel:choice>
                <!-- processing test8 -->
                <camel:when>
                    <camel:simple>${header.Task} == 'test8'</camel:simple>
                    <camel:log message="Test 8 header involved!"/>
                    <camel:to uri="bean:justConsumer?method=consumeFromQueue"/>
                </camel:when>
                <!-- processing test9 -->
                <camel:when>
                    <camel:simple>${header.Task} == 'test9'</camel:simple>
                    <camel:log message="Test 9 was involved, splitter pattern example!"/>
                    <camel:to uri="bean:justConsumer?method=consumeFromQueue"/>
                </camel:when>
            </camel:choice>
        </camel:route>

        <!-- processing test2 -->
        <camel:route id="myTopicRoute">
            <camel:from uri="activemq://topic:Topic"/>
            <camel:multicast>
                <camel:to uri="bean:a?method=consumeFromTopic"/>
                <camel:to uri="bean:b?method=consumeFromTopic"/>
                <camel:to uri="bean:c?method=consumeFromTopic"/>
            </camel:multicast>
        </camel:route>

        <!-- processing test7 -->
        <!--<camel:route id="fileRoute">-->
            <!--<camel:from uri="activemq:queue:FileQueue"/>-->
            <!--<camel:validate>-->
                <!--<camel:simple>${header.Task} == 'test7'</camel:simple>-->
            <!--</camel:validate>-->
            <!--<camel:log message="Test 7 was involved, message filter pattern for file example!"/>-->
            <!--<camel:to uri="file:D:/temp/output"/>-->
        <!--</camel:route>-->
    </camel:camelContext>

</beans>
