<?xml version="1.0"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:camel="http://camel.apache.org/schema/spring"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
          http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

    <!-- for queue -->
    <bean id="myFirstConsumer" class="com.epam.democml.Consumer">
        <property name="name" value="first consumer"/>
    </bean>
    <bean id="mySecondConsumer" class="com.epam.democml.Consumer">
        <property name="name" value="second consumer"/>
    </bean>
    <bean id="justConsumer" class="com.epam.democml.Consumer"/>
    <bean id="deserialization" class="com.epam.democml.processor.ActiveMQUnwrapper"/>
    <bean id="myDroppedBean" class="com.epam.democml.DroppedHandler"/>

    <!-- for topic -->
    <bean id="a" class="com.epam.democml.Consumer"/>
    <bean id="b" class="com.epam.democml.Consumer"/>
    <bean id="c" class="com.epam.democml.Consumer"/>

    <camel:camelContext id="camelCtx">
        <camel:route id="myQueueRoute">
            <camel:from uri="activemq://queue:Queue?concurrentConsumers=2"/>
            <!--<camel:to uri="log:com.mycompany.MyLog?level=INFO"/>-->
            <camel:log message="Me got ${body}" loggingLevel="INFO"
                       logName="com.mycompany.MyCoolRouteLog"/>
            <camel:choice>

                <!-- processing test5 -->
                <camel:when>
                    <!-- USE -->
                    <!-- Requires camel-juel or juel dependency -->
                    <camel:el>${in.headers.Task == 'test5'}</camel:el>
                    <!-- OR -->
                    <!--<camel:simple>${header.task} == 'test5'</camel:simple>-->
                    <camel:choice>
                        <camel:when>
                            <camel:simple>${header.Consumer} == '1'</camel:simple>
                            <camel:to uri="bean:myFirstConsumer?method=consumeFromQueue"/>
                        </camel:when>
                        <camel:when>
                            <camel:simple>${header.Consumer} == '2'</camel:simple>
                            <camel:to uri="bean:mySecondConsumer?method=consumeFromQueue"/>
                        </camel:when>
                        <camel:otherwise>
                            <camel:to uri="bean:myDroppedBean"/>
                        </camel:otherwise>
                    </camel:choice>
                </camel:when>

                <!-- processing test6 -->
                <camel:when>
                    <camel:simple>${header.Task} == 'test6'</camel:simple>
                    <camel:process ref="deserialization"/>
                    <camel:to uri="bean:justConsumer?method=consumeFromQueue"/>
                </camel:when>

                <!-- processing test1, test3, test4 -->
                <camel:otherwise>
                    <camel:to uri="bean:justConsumer?method=consumeFromQueue"/>
                </camel:otherwise>
            </camel:choice>

        </camel:route>

        <!-- processing test2 -->
        <camel:route id="myTopicRoute">
            <camel:from uri="activemq://topic:Topic"/>
            <camel:multicast>
                <camel:to uri="bean:a?method=consumeFromTopic"/>
                <camel:to uri="bean:b?method=consumeFromTopic"/>
                <camel:to uri="bean:c?method=consumeFromTopic"/>
            </camel:multicast>
        </camel:route>

    </camel:camelContext>

</beans>
